<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign - In | Host</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../../assets/css/style.css" />
    <link rel="stylesheet" href=../../assets/css/sign-in.css>
  </head>
  <style>
    input:valid {
      box-shadow: inset 0 1px 1px rgb(0, 255, 0), 0 0 8px rgba(7, 188, 46, 0.6);
    }

    input:invalid {
      box-shadow: inset 0 1px 1px rgb(228, 19, 19), 0 0 8px rgba(236, 8, 8, 0.6);
    }
  </style>
  <body>
    <header>
      <!-- using symantic tags -->
      <nav class="navbar header">
        <!-- navbar -->
        <div class="container">
          <a class="navbar-brand" href="../../index.html">
            <img class="logo" src="#" alt="#" />
          </a>
        </div>
      </nav>
    </header>
    <!-- signin-card-->
    <section class="signin-section">
      <!-- creating a card using bootstrap -->
      <div class="create-heading"><h3>Create Your Workspace</h3></div>
      <div class="container-fluid">
        <form class="sign-in-card" action="">
          <div class="container-fluid">
            <div class="form-floating mb-3 name input">
              <input
                type="text"
                class="form-control first-name text"
                id="floatingInput"
                pattern="^[a-zA-Z][a-zA-Z0-9-_\.]{1,20}$"
                placeholder="Steve"
                required
              />
              <label for="floatingInput">First Name</label>
            </div>
            <div class="form-floating mb-3 input">
              <input
                type="text"
                class="form-control text last-name"
                pattern="^[a-zA-Z][a-zA-Z0-9-_\.]{1,20}$"
                id="floatingInput"
                placeholder="Rogers"
                required
              />
              <label for="floatingInput">Last Name</label>
            </div>
          </div>
          <div class="signin-email">
            <div class="form-floating mb-3 input">
              <input
                type="email"
                class="form-control email"
                id="floatingInput"
                placeholder="name@example.com"
                required
              />
              <label for="floatingInput">Email address</label>
            </div>
          </div>
          <div class="signin-key">
            <div class="form-floating mb-3 input">
              <input
                type="text"
                class="form-control key"
                id="floatingInput"
                placeholder="name@example.com"
                required
              />
              <label for="floatingInput">Sharing Key (optional)</label>
            </div>
          </div>
          <div class="sign-in-pass container-fluid">
            <div class="form-floating name">
              <input
                type="password"
                class="form-control text password"
                id="floatingPassword password"
                pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\s).*$"
                placeholder="Password"
                required
              />
              <label for="floatingPassword">Password</label>
            </div>
            <div class="form-floating name">
              <input
                type="password"
                class="form-control text confo-password"
                id="floatingPassword"
                placeholder="Password"
                required
              />
              <label for="floatingPassword">Confirm Password</label>
            </div>
          </div>
          <div class="log-in-btn container">
            <button
              type="button"
              id="sign-in-btn"
              class="btn btn-primary log-btn"
            >
              Sign In
            </button>
          </div>
        </form>
        <img
          src="../../assets/images/12281509_4942219.jpg"
          class="img-fluid sign-in-image"
        />
      </div>
      <a href="../Ticket Page/dashboard.html"></a>
    </section>
  </body>
  <script></script>
  <script>
    document.getElementById("sign-in-btn").addEventListener("click", (e) => {
      let arr = [];
      let existDatas = JSON.parse(localStorage.getItem("signinData"));
      let validation = false;
      let teamData = new Object();
      let user = new Object();

      teamData["org"] = "Add";
      user["position"] = "Add";
      user["name"] =
        document.querySelector(".first-name").value.trim() +
        " " +
        document.querySelector(".last-name").value.trim();
      user["email"] = document
        .querySelector(".email")
        .value.trim()
        .toLowerCase();
      user["profileLink"] =
        "../../assets/images/blank-profile-picture-973460_1280.webp";
      if (document.querySelector(".key").value == "") {
        teamData["channal"] = crypto.randomUUID();
        // console.log(teamData["channal"], crypto.randomUUID());
      } else {
        teamData["channal"] = document.querySelector(".key").value;
      }
      user["password"] = document.querySelector(".password").value.trim();
      if (existDatas === null) {
        let members = [];
        members.push(user);
        teamData["members"] = members;
        arr.push(teamData);
        localStorage.setItem("signinData", JSON.stringify(arr));
        window.location.href = "./login.html";
      } else {
        let exists;
        for (let i = 0; i < existDatas.length; i++) {
          let valid = existDatas[i]["members"].find(
            (validation) => user["email"] === validation["email"]
          );
          if (valid !== undefined) {
            exists = valid;
          }
        }
        if (exists) {
          console.log(exists);
          return alert("Already Exists");
        }
        let channal = existDatas.find(
          (org) => org["channal"] === teamData["channal"]
        );
        console.log(channal);
        if (channal) {
          let index = existDatas.indexOf(channal);
          channal["members"].push(user);
          existDatas.splice(index, 1, channal);
          localStorage.setItem("signinData", JSON.stringify(existDatas));
          window.location.href = "./login.html";
        } else {
          let members = [];
          members.push(user);
          teamData["members"] = members;
          existDatas.push(teamData);
          localStorage.setItem("signinData", JSON.stringify(existDatas));
          window.location.href = "./login.html";
        }
      }
    });
  </script>
</html>
